<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4.1: http://docutils.sourceforge.net/" />
<title></title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document">
<!-- -*- mode: rst -*- -->
<div class="section">
<h1><a class="toc-backref" href="#id1" id="paella-installer" name="paella-installer">Paella Installer</a></h1>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#paella-installer" id="id1" name="id1">Paella Installer</a></li>
<li><a class="reference" href="#installer" id="id2" name="id2">Installer</a><ul>
<li><a class="reference" href="#trait-installer" id="id3" name="id3">Trait Installer</a></li>
<li><a class="reference" href="#profile-installer" id="id4" name="id4">Profile Installer</a></li>
<li><a class="reference" href="#nfs-installer" id="id5" name="id5">Nfs Installer</a></li>
<li><a class="reference" href="#installer-toolkit" id="id6" name="id6">Installer Toolkit</a></li>
<li><a class="reference" href="#automatic-install" id="id7" name="id7">Automatic Install</a></li>
<li><a class="reference" href="#new-installer-outline" id="id8" name="id8">New Installer Outline</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id2" id="installer" name="installer">Installer</a></h1>
<p>The installers in paella are layered.  There is a <a class="reference" href="#trait-installer">trait installer</a>, a <a class="reference" href="#profile-installer">profile installer</a>,
and a <a class="reference" href="#nfs-installer">nfs installer</a>.  The installers are layered to make the whole installing
operation more structured.  The trait installer is the simplest and contains everything
needed for installing a trait.  The profile installer contains a trait installer, and it is
responsible for installing profiles.  The nfs installer contains a profile installer and is used
to install a profile on a machine.  There is also a chroot installer that will install a profile
to a target directory.</p>
<div class="section">
<h2><a class="toc-backref" href="#id3" id="trait-installer" name="trait-installer">Trait Installer</a></h2>
<p>The trait installer is responsible for installing a trait to a target location.
It is pretty dumb as it doesn't check to see if a parent has been installed or not.
This class should only be instantiated as a member of the <a class="reference" href="#profile-installer">profile installer</a> class,
or a similiar class because the profiledata and familydata members start out empty.</p>
<ul class="simple">
<li>default trait install processes (in order)<ul>
<li><strong>pre</strong><ul>
<li>special script step</li>
<li>if it exists, run the script before anything else</li>
</ul>
</li>
<li><strong>remove</strong><ul>
<li>remove packages marked remove in trait's package list</li>
</ul>
</li>
<li><strong>install</strong><ul>
<li>install packages marked install in trait's package list</li>
</ul>
</li>
<li><strong>templates</strong><ul>
<li>install the templates for the trait</li>
</ul>
</li>
<li><strong>config</strong><ul>
<li>currently doesn't do anything, can be used for a script</li>
</ul>
</li>
<li><strong>chroot</strong><ul>
<li>special script step</li>
<li>if it exists, run the script chrooted in the target</li>
</ul>
</li>
<li><strong>reconfig</strong><ul>
<li>runs dpkg-reconfigure -plow on packages marked
reconfig in the trait's package list.</li>
</ul>
</li>
<li><strong>post</strong><ul>
<li>special script step</li>
<li>if it exists, run the script after everything else</li>
</ul>
</li>
</ul>
</li>
<li>the default trait processes can be overridden<ul>
<li>put a comma separated list of processes in the default_environment
under the section, <strong>installer</strong>, and the option <strong>trait_processes</strong>.</li>
</ul>
</li>
</ul>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id4" id="profile-installer" name="profile-installer">Profile Installer</a></h2>
<p>The profile installer can be instantiated by itself.  It contains a trait installer.
It is responsible for installing a profile to a target location.  A profile is the minimum
install-able object, you can't install a trait alone, but you can have a profile with one trait
in it.  The profile installer is responsible for making the complete list of traits that will be
installed.  The list is composed of the traits listed in the profile itself, and all of their implied
parents, ordered for install.  The profile installer then calls its trait installer for each trait
in the list.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id5" id="nfs-installer" name="nfs-installer">Nfs Installer</a></h2>
<p>The nfs installer is responsible for installing a machine to a target location.  This is the
installer that will be run on a machine to be installed.  This installer contains a profile
installer.  The nfs installer will do all of the hardware related functions that are necessary
to setup a target location for its profile installer.  The nfs installer will also setup the fstab,
apt sources, and kernel for the machine.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id6" id="installer-toolkit" name="installer-toolkit">Installer Toolkit</a></h2>
<p>The installer toolkit is made to be used in the trait scripts.  It can't be
used for the chroot script, unless you have paella configured on the
target system.  It is the job of the installer toolkit to provide you with a
good set of tools contained within the toolkit object, so that your scripts
contain a minimum of boilerplate type code.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id7" id="automatic-install" name="automatic-install">Automatic Install</a></h2>
<p>Automatic installation is supported.  The setup if fairly simple.  There
is no gui wrapper around parts of it yet, so to really use it, you will
have to use python interactively, or psql.  There is a script on the nfs
installer called paella-submit-machine.  You pass it a machine name
argument</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id8" id="new-installer-outline" name="new-installer-outline">New Installer Outline</a></h2>
<p>Here is an outline of the new installer system.  It is centered around a
base processor class.  The base processor class has a list of processes and a map
that links the processes to methods in the processor class.  The base processor includes
a logging object and pre/post hooks that can be applied to each process.  A processor can
have a processor as an attribute, and have it's run_all_processes method invoked as a
process.  In this manner, processors can be chained together.  Each process can have
a script attached to it.  This script will be invoked instead of the normal process if it is
present.  It is up to the subclass to define a make_script method to do this.</p>
<p>Each installer object will be a subclass of the base processor.</p>
<p>class hierarchy</p>
<ul class="simple">
<li><strong>BaseProcessor(object)</strong></li>
<li><strong>BaseInstaller(BaseProcessor)</strong><ul>
<li>properties:<ul>
<li>has a target, can create target directory</li>
<li>there is no process list in this class</li>
<li>process list to be defined in subclass</li>
<li>logging is setup here</li>
<li>takes a db connection as init arg</li>
<li>suite is set here, base_suite is also determined</li>
</ul>
</li>
</ul>
</li>
<li><strong>ChrootInstaller(BaseInstaller)</strong><ul>
<li>properties:<ul>
<li>process list defined</li>
<li>has installer attribute (usually ProfileInstaller)</li>
<li>set profile and target path before processing</li>
</ul>
</li>
<li>processes:<ul>
<li>ready_target</li>
<li>bootstrap</li>
<li>mount_target_proc</li>
<li>mount_target_sys</li>
<li>make_device_entries (probably deprecated by udev)</li>
<li>apt_sources_installer</li>
<li>ready_base_for_install</li>
<li>pre_install</li>
<li>install</li>
<li>post_install</li>
<li>apt_sources_final</li>
<li>umount_target_sys</li>
<li>umount_target_proc</li>
</ul>
</li>
</ul>
</li>
<li><strong>MachineInstaller(ChrootInstaller)</strong><ul>
<li>processes:<ul>
<li>pre - MachineInstaller</li>
<li>setup_disks - MachineInstaller</li>
<li>ready_target - inherit from ChrootInstaller</li>
<li>mount_target - MachineInstaller</li>
<li>bootstrap - inherit from ChrootInstaller</li>
<li>mount_target_proc - inherit from ChrootInstaller</li>
<li>mount_target_sys - inherit from ChrootInstaller</li>
<li>make_device_entries (probably deprecated by udev) - inherit from ChrootInstaller</li>
<li>apt_sources_installer - inherit from ChrootInstaller</li>
<li>ready_base_for_install - inherit from ChrootInstaller</li>
<li>pre_install - inherit from ChrootInstaller</li>
<li>install - inherit from ChrootInstaller</li>
<li>post_install - inherit from ChrootInstaller</li>
<li>install_fstab</li>
<li>install_modules</li>
<li>install_kernel</li>
<li>apt_sources_final</li>
<li>umount_target_proc</li>
<li>post</li>
</ul>
</li>
</ul>
</li>
<li><strong>TraitInstaller(BaseInstaller)</strong><ul>
<li>properties:<ul>
<li>created from ProfileInstaller</li>
</ul>
</li>
<li>processes:<ul>
<li>pre</li>
<li>remove</li>
<li>install</li>
<li>templates</li>
<li>config</li>
<li>chroot</li>
<li>reconfig</li>
<li>post</li>
</ul>
</li>
</ul>
</li>
<li><strong>ProfileInstaller(BaseInstaller)</strong><ul>
<li>properties:<ul>
<li>created with a chroot installer as a parent</li>
<li>process list is generated from the ordered list of traits to be
installed for the process.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="docutils" />
<p>This <a class="reference" href="http://developer.berlios.de/projects/paella">project</a> is hosted by <a class="reference" href="http://developer.berlios.de"><img alt="berlios" src="http://developer.berlios.de/bslogo.php?group_id=0&amp;type=1" /></a>.</p>
<p><a class="reference" href="/">home</a></p>
</div>
</div>
</div>
</body>
</html>
